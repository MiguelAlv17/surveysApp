import{i as z,r,o as P,j as F,c as d,d as m,e as a,f as l,w as o,k as q,v as J,g as D,l as S,m as h,t as x,p as K,D as Q,F as Z}from"./index-cdc5c833.js";import{u as ee}from"./getDataUsuarios-ec8514d1.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";import{a as _,C as se,b as te,c as oe}from"./alerts-7dbfee83.js";import{M as g}from"./ModernButton-8b041619.js";import{B,M as re}from"./BtnTable-290ad832.js";import{L as T}from"./LoaderBtn-cd6be9a3.js";import{u as k,w as le}from"./xlsx-b3bc961a.js";const ne={class:"search-and-actions"},ie={class:"search-section"},ue={class:"search-container"},de={class:"search-input-wrapper"},ce={class:"input-group"},pe={class:"search-actions"},me={key:1,class:"material-icons"},ve={class:"table-section"},fe={key:0,class:"material-icons text-success-custom"},_e={key:1,class:"material-icons text-danger-custom"},ge={class:"footer-content"},be={class:"footer-info"},he={class:"footer-actions"},xe={class:"last-update"},we={key:1,class:"material-icons"},ye="DD/MM/YYYY hh:mm:ss",Ee={__name:"Index",setup(De){const{getListUsers:A,updateUser:Y}=ee(),I=z(),N=r([{text:"ID",value:"id",sortable:!0},{text:"Nombre",value:"nombre",sortable:!0},{text:"Email",value:"email",sortable:!0},{text:"Perfil",value:"tipoUsuario"},{text:"Estatus",value:"status"},{text:"Acciones",value:"actions",width:150}]),i=r([]),C=["userid","username","correo","level"],u=r(""),w=r(!1),v=r(!1),f=r(!1),y=r(0),b=r(!1),M=r("--/--/--"),U=r("");P(()=>{E()});const E=async()=>{w.value=!0;const t=await A();w.value=!1;const{status:e,data:s}=t;if(e!=200){_("ocurrio un error al cargar los datos");return}const c=s.data.map(n=>(n.tipo_usuario_name=$(n.tipo_usuario),n.estado=n.estado==1?"Habilitado":"Deshabilitado",n));i.value=c,M.value=F().format(ye)},$=t=>t==1?"Administrador":t==2?"Monitoreo":"--",R=async t=>{let e=`/users/edit/${t}`;I.push(e)},V=async()=>{I.push("/users/add")},H=t=>{f.value=!0,y.value=t;const e=i.value.filter(s=>s.usuarioId==y.value);if(e==null){_("oops","Ocurrio un error al mostrar el modal",2.5);return}U.value=`Esta seguro de DESHABILITAR al usuario: "${e[0].fullname}"?`},O=async()=>{const t=i.value.filter(n=>n.usuarioId==y.value);if(t==null){_("oops","Ocurrio un error al eliminar el usuario",2.5);return}b.value=!0,t[0].estado=0;const e=await Y(t[0]),{status:s,data:c}=e;if(b.value=!1,f.value=!1,s!=200){_("Oops!","Ocurrio un error al eliminar el usuario");return}await te("Exito!","Usuario deshabilitado correctamente"),E()},W=async()=>{try{v.value=!0;let t=i.value;if(u.value&&u.value.trim()!==""){const p=u.value.toLowerCase();t=i.value.filter(G=>C.some(X=>{const L=G[X];return L&&L.toString().toLowerCase().includes(p)}))}const e=t.map(p=>({ID:p.id,Nombre:p.nombre,Correo:p.email,"Rol de usuario":p.tipoUsuario,Estado:p.activo==!0?"Habilitado":"Deshabilitado"})),s=k.book_new(),c=k.json_to_sheet(e),n=[{wch:10},{wch:30},{wch:30},{wch:15},{wch:15}];c["!cols"]=n,k.book_append_sheet(s,c,"Users List");const j=`UsersList_${F().format("YYYY-MM-DD_HH-mm")}.xlsx`;le(s,j),await oe("Generando archivo excel","generando",4)}catch(t){console.error("Error al exportar:",t),_("Error al exportar el archivo Excel")}finally{v.value=!1}};return(t,e)=>(d(),m(Z,null,[a("div",null,[l(se,{loading:w.value,title:"USUARIOS",subtitle:"Listado de usuarios y acciones",icon:"groups"},{"header-actions":o(()=>e[4]||(e[4]=[])),body:o(()=>[a("div",ne,[a("div",ie,[a("div",ue,[a("div",de,[e[7]||(e[7]=a("label",{class:"search-label"},"Buscar:",-1)),a("div",ce,[e[6]||(e[6]=a("div",{class:"input-icon"},[a("span",{class:"material-icons"},"search")],-1)),q(a("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),type:"text",class:"search-input",placeholder:"Filtrar por coincidencia..."},null,512),[[J,u.value]]),u.value?(d(),m("button",{key:0,onClick:e[1]||(e[1]=s=>u.value=""),class:"clear-search",type:"button"},e[5]||(e[5]=[a("span",{class:"material-icons"},"close",-1)]))):D("",!0)])]),a("div",pe,[l(g,{color:"green",function:W,disabled:v.value||i.value.length===0,tooltip:"Exportar a Excel"},{default:o(()=>[v.value?(d(),S(T,{key:0})):(d(),m("span",me,"file_download")),h(" "+x(v.value?"Exportando...":"Exportar Excel"),1)]),_:1},8,["disabled"]),l(g,{color:"blue",function:V,tooltip:"Agregar nuevo registro"},{default:o(()=>e[8]||(e[8]=[a("span",{class:"material-icons"},"add",-1),h(" Agregar ",-1)])),_:1,__:[8]})])])])]),a("div",ve,[l(K(Q),{headers:N.value,items:i.value,"search-field":C,"search-value":u.value,"header-text-direction":"center","body-text-direction":"center","rows-per-page-message":"Registros por página","empty-message":"Sin registros disponibles","rows-of-page-separator-message":"de",alternating:"","buttons-pagination":"","table-class-name":"modern-table","theme-color":"#667eea","table-height":500,class:"custom-data-table"},{"item-actions":o(s=>[l(B,{color:"gray",onFunction:c=>R(s.usuarioId),tooltip:"Editar usuario"},{default:o(()=>e[9]||(e[9]=[a("span",{class:"material-icons"},"edit",-1)])),_:2,__:[9]},1032,["onFunction"]),l(B,{color:"red",onFunction:c=>H(s.usuarioId),tooltip:"Eliminar usuario"},{default:o(()=>e[10]||(e[10]=[a("span",{class:"material-icons"},"delete",-1)])),_:2,__:[10]},1032,["onFunction"])]),"item-status":o(s=>[s.activo?(d(),m("span",fe," toggle_on ")):D("",!0),s.activo?D("",!0):(d(),m("span",_e," toggle_off "))]),_:1},8,["headers","items","search-value"])])]),footer:o(()=>[a("div",ge,[a("div",be,[e[11]||(e[11]=a("span",{class:"material-icons"},"info",-1)),a("span",null,x(i.value.length)+" registros en total",1)]),a("div",he,[a("span",xe,"Última actualización: "+x(M.value),1),l(g,{color:"lile",function:E,tooltip:"Recargar la tabla"},{default:o(()=>e[12]||(e[12]=[a("span",{class:"material-icons"},"update",-1)])),_:1,__:[12]})])])]),_:1},8,["loading"])]),l(re,{show:f.value,"onUpdate:show":e[3]||(e[3]=s=>f.value=s),title:"Deshabilitar usuario",icon:"group_remove",width:40,maxWidth:"800px",closable:!1},{body:o(()=>[a("h6",null,x(U.value),1),e[13]||(e[13]=a("small",{class:"text-secondary"},"La accion no podra deshacerse",-1))]),footer:o(()=>[l(g,{color:"lile",onClick:e[2]||(e[2]=s=>f.value=!1)},{default:o(()=>e[14]||(e[14]=[h(" Cancelar ",-1)])),_:1,__:[14]}),l(g,{color:"red",onClick:O,disabled:b.value},{default:o(()=>[b.value?(d(),S(T,{key:0})):(d(),m("span",we,"do_not_disturb_alt")),e[15]||(e[15]=h(" Deshabilitar ",-1))]),_:1,__:[15]},8,["disabled"])]),_:1},8,["show"])],64))}},Be=ae(Ee,[["__scopeId","data-v-447f8a9d"]]);export{Be as default};
