import{i as z,r as o,o as G,j as b,c as p,d as g,e as a,f as l,w as s,k as U,v as W,g as X,l as F,m as d,t as h,p as y,D as J,q as K,F as P}from"./index-cdc5c833.js";import{a as w,C as Q,b as D}from"./alerts-7dbfee83.js";import{M as v}from"./ModernButton-8b041619.js";import{B as Z,M as ee}from"./BtnTable-290ad832.js";import{L}from"./LoaderBtn-cd6be9a3.js";import{u as E,w as ae}from"./xlsx-b3bc961a.js";import{u as te}from"./getDataSurveys-1126ab61.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";const oe={class:"search-and-actions"},re={class:"search-section"},le={class:"search-container"},ne={class:"search-input-wrapper"},ie={class:"input-group"},ce={class:"search-actions"},de={key:1,class:"material-icons"},ue={class:"table-section"},pe={class:"footer-content"},me={class:"footer-info"},ve={class:"footer-actions"},fe={class:"last-update"},_e={key:1,class:"material-icons"},be="DD/MM/YYYY hh:mm:ss",ge={__name:"IndexAdmin",setup(he){const{getSurveysList:A}=te(),B=z(),T=o([{text:"Clave",value:"id",sortable:!0},{text:"Nombre",value:"titulo",sortable:!0},{text:"Descripcion",value:"descripcion",sortable:!0},{text:"Elaborada por",value:"nombreCreador",sortable:!0},{text:"Elaborada el dia",value:"fechaFormated",sortable:!0},{text:"Acciones",value:"actions",sortable:!0}]),u=o([]),C=["id","titulo","descripcion","nombreCreador"],n=o("");o("");const x=o(!1),f=o(!1),m=o(!1),k=o(null),_=o(!1),Y=o(0),I=o(0);G(()=>{I.value=localStorage.getItem("userRole"),S()});const S=async()=>{x.value=!0;const r=await A();console.log(r),x.value=!1,k.value=b().format(be);const{status:e,data:t}=r;if(e!=200){w("Ocurrio un error al cargar los datos");return}u.value=t.data.map(i=>(i.fechaFormated=b(i.fechaCreacion).format("DD/MM/YYYY hh:mm a"),i))},V=async()=>{f.value=!0;const r={id_kiosco:Y.value.dvr_id_kiosco,id_dvr:Y.value.dvr_id,solicito:1},e=await openDvr(r),{status:t}=e;if(_.value=!1,f.value=!1,t!=200){w("Oops!","Ocurrio un abrir al enviar la solicitud de apertura");return}D("Apertura realizada")},N=()=>{try{m.value=!0;let r=u.value;if(n.value&&n.value.trim()!==""){const c=n.value.toLowerCase();r=u.value.filter(H=>C.some(q=>{const M=H[q];return M&&M.toString().toLowerCase().includes(c)}))}const e=r.map(c=>({ID:c.id,Titulo:c.titulo,Descripccion:c.descripcion,"Elaborada por":c.nombreCreador,"Elaborada el dia":c.fechaFormated})),t=E.book_new(),i=E.json_to_sheet(e),$=[{wch:15},{wch:25},{wch:45},{wch:25}];i["!cols"]=$,E.book_append_sheet(t,i,"Surveys List");const j=`SurveysList_${b().format("YYYY-MM-DD_HH-mm")}.xlsx`;ae(t,j),D("Archivo Excel Generado exitosamente")}catch(r){console.error("Error al exportar:",r),w("Error al exportar el archivo Excel")}finally{m.value=!1}},R=()=>{B.push("/surveys/add")},O=()=>{D("Oops","Trabajo en proceso",3)};return(r,e)=>(p(),g(P,null,[a("div",null,[l(Q,{title:"Encuestas",subtitle:"Listado de usuarios con sus encuestas",loading:x.value,icon:"file_present"},{body:s(()=>[a("div",oe,[a("div",re,[a("div",le,[a("div",ne,[e[6]||(e[6]=a("label",{class:"search-label"},"Buscar:",-1)),a("div",ie,[e[5]||(e[5]=a("div",{class:"input-icon"},[a("span",{class:"material-icons"},"search")],-1)),U(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t),type:"text",class:"search-input",placeholder:"Filtrar por coincidencia..."},null,512),[[W,n.value]]),n.value?(p(),g("button",{key:0,onClick:e[1]||(e[1]=t=>n.value=""),class:"clear-search",type:"button"},e[4]||(e[4]=[a("span",{class:"material-icons"},"close",-1)]))):X("",!0)])]),a("div",ce,[l(v,{color:"green",function:N,disabled:m.value||u.value.length===0,tooltip:"Exportar a Excel"},{default:s(()=>[m.value?(p(),F(L,{key:0})):(p(),g("span",de,"file_download")),d(" "+h(m.value?"Exportando...":"Exportar Excel"),1)]),_:1},8,["disabled"]),l(v,{color:"blue",function:R,tooltip:"Agregar nuevo registro"},{default:s(()=>e[7]||(e[7]=[a("span",{class:"material-icons"},"add",-1),d(" Agregar ",-1)])),_:1,__:[7]})])])])]),a("div",ue,[l(y(J),{headers:T.value,items:u.value,"search-field":C,"search-value":n.value,"header-text-direction":"center","body-text-direction":"center","rows-per-page-message":"Registros por página","empty-message":"Sin registros disponibles","rows-of-page-separator-message":"de",alternating:"","table-height":y(K),"buttons-pagination":"","table-class-name":"modern-table","theme-color":"#667eea",class:"custom-data-table"},{"item-lastupdated":s(t=>[d(h(y(b)(t.last_updated).format("DD/MM/YYYY hh:mm a")),1)]),"item-actions":s(t=>[l(Z,{class:"ms-2",color:"red",onFunction:i=>O(t),tooltip:"Eliminar encuesta"},{default:s(()=>e[8]||(e[8]=[a("span",{class:"material-icons"},"delete",-1)])),_:2,__:[8]},1032,["onFunction"])]),_:1},8,["headers","items","search-value","table-height"])])]),footer:s(()=>[a("div",pe,[a("div",me,[e[9]||(e[9]=a("span",{class:"material-icons"},"info",-1)),a("span",null,h(u.value.length)+" registros en total",1)]),a("div",ve,[a("span",fe,"Última actualización: "+h(k.value),1),l(v,{color:"lile",function:S,tooltip:"Recargar la tabla"},{default:s(()=>e[10]||(e[10]=[a("span",{class:"material-icons"},"update",-1)])),_:1,__:[10]})])])]),_:1},8,["loading"])]),l(ee,{show:_.value,"onUpdate:show":e[3]||(e[3]=t=>_.value=t),title:"Confirmacion de apertura DVR",icon:"meeting_room",width:40,maxWidth:"800px",closable:!1},{body:s(()=>e[11]||(e[11]=[a("h6",null,[d("Esta seguro de "),a("strong",null,"abrir"),d(" la puerta del DVR?")],-1),a("small",{class:"text-secondary"},"La accion no podra deshacerse",-1)])),footer:s(()=>[l(v,{color:"lile",onClick:e[2]||(e[2]=t=>_.value=!1)},{default:s(()=>e[12]||(e[12]=[d(" Cancelar ",-1)])),_:1,__:[12]}),l(v,{color:"green",onClick:V,disabled:f.value},{default:s(()=>[f.value?(p(),F(L,{key:0})):(p(),g("span",_e,"login")),e[13]||(e[13]=d(" Apertura ",-1))]),_:1,__:[13]},8,["disabled"])]),_:1},8,["show"])],64))}},Se=se(ge,[["__scopeId","data-v-f8265d5f"]]);export{Se as default};
