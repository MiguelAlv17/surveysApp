import{a as ne,i as le,r as v,s as O,o as ue,x as de,c as i,d,f as n,w as l,e as t,m as p,n as ce,k as pe,v as me,t as C,g as x,l as L,F as ge,y as ve,z as be,h as fe}from"./index-cdc5c833.js";import{C as _e,a as q,b as B,c as D}from"./alerts-7dbfee83.js";import{B as Q,M as xe}from"./BtnTable-290ad832.js";import{M as y}from"./ModernButton-8b041619.js";import{M as S}from"./ModernInput-32844397.js";import{M as he}from"./ModernSelect-fa688c41.js";import{L as N}from"./LoaderBtn-cd6be9a3.js";import{u as Pe}from"./getDataSurveys-1126ab61.js";import{_ as ye}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                                                                     */const ke={class:"form-container"},Ce={class:"form-group mt-3"},Ee=["disabled"],we={key:0,class:"error-text"},Ae={class:"form-group mt-4"},Fe={class:"permission-options"},Oe={class:"radio-wrapper"},qe=["checked","disabled"],Ve={class:"custom-checkbox"},Be={key:0,class:"material-icons"},De={class:"radio-wrapper"},Qe=["checked","disabled"],Se={class:"custom-checkbox"},$e={key:0,class:"material-icons"},Me={key:0,class:"error-text"},Te={class:"questions-section mt-5"},Le={class:"section-header"},Ne={class:"questions-table-container"},Ie={key:0,class:"material-icons text-success-custom"},Ue={key:1,class:"material-icons text-danger-custom"},Ge={class:"footer-content"},je={class:"footer-info"},ze={class:"footer-actions"},Re={class:"action-buttons"},Ke={key:1,class:"material-icons"},He={class:"question-form"},We={class:"form-group mt-3"},Je={class:"radio-group"},Xe=["onClick"],Ye={class:"radio-wrapper"},Ze=["checked","value","disabled","onChange"],et={class:"custom-radio"},tt={key:0,class:"radio-dot"},ot={class:"radio-label"},at={key:0,class:"error-text"},st={key:0,class:"options-section mt-4"},rt={class:"add-option-container"},it={class:"add-option-row"},nt={class:"option-input-wrapper"},lt={class:"add-option-button"},ut={key:0,class:"options-table"},dt={key:1,class:"no-options-message"},ct={class:"modal-footer-buttons"},pt={key:1,class:"material-icons"},mt={__name:"Add",setup(gt){ne();const $=le(),{addNewSurvey:I}=Pe(),U=v(!1),g=v(!1),h=v(!1),m=v(!1),G=v([{text:"Orden",value:"orden",sortable:!0},{text:"Pregunta",value:"textoPregunta",sortable:!0},{text:"Tipo",value:"tipoPregunta",sortable:!0},{text:"Obligatoria",value:"obligatoria",sortable:!0},{text:"Acciones",value:"actions"}]),E=v([]),j=["textoPregunta","tipoPregunta"],z=v(""),r=O({titulo:"",descripcion:"",permitirAsesor:!1,permitirFacilitador:!1,preguntas:[]}),u=O({titulo:"",descripcion:"",permisos:""}),s=O({orden:0,textoPregunta:"",tipoPregunta:"",obligatoria:"",opciones:[]}),c=O({textoPregunta:"",tipoPregunta:"",obligatoria:""}),f=v(""),k=v(""),R=[{label:"Texto libre",value:"texto_libre"},{label:"Opción múltiple",value:"opcion_multiple"},{label:"Selección múltiple",value:"seleccion_multiple"}],K=[{label:"Sí",value:!0},{label:"No",value:!1}],H=v([{text:"Orden",value:"orden",sortable:!0},{text:"Texto de Opción",value:"textoOpcion",sortable:!0},{text:"Acciones",value:"actions"}]);ue(()=>{});const _=(o,e)=>{switch(o){case"titulo":return e.trim()?e.length<5?(u.titulo="El título debe tener al menos 5 caracteres",!1):(u.titulo="",!0):(u.titulo="El título es requerido",!1);case"descripcion":return e.trim()?e.length<10?(u.descripcion="La descripción debe tener al menos 10 caracteres",!1):(u.descripcion="",!0):(u.descripcion="La descripción es requerida",!1);case"permisos":return!r.permitirAsesor&&!r.permitirFacilitador?(u.permisos="Debe seleccionar al menos un tipo de usuario",!1):(u.permisos="",!0);default:return!0}},P=(o,e)=>{switch(o){case"textoPregunta":return e.trim()?e.length<5?(c.textoPregunta="La pregunta debe tener al menos 5 caracteres",!1):(c.textoPregunta="",!0):(c.textoPregunta="El texto de la pregunta es requerido",!1);case"tipoPregunta":return e?(c.tipoPregunta="",!0):(c.tipoPregunta="Debe seleccionar un tipo de pregunta",!1);case"obligatoria":return e===""?(c.obligatoria="Debe indicar si la pregunta es obligatoria",!1):(c.obligatoria="",!0);default:return!0}},W=()=>[_("titulo",r.titulo),_("descripcion",r.descripcion),_("permisos","")].every(Boolean),J=()=>{const o=[P("textoPregunta",s.textoPregunta),P("tipoPregunta",s.tipoPregunta),P("obligatoria",s.obligatoria)];return(s.tipoPregunta==="opcion_multiple"||s.tipoPregunta==="seleccion_multiple")&&s.opciones.length===0?(D("Debe agregar al menos una opción para este tipo de pregunta"),!1):o.every(Boolean)},M=(o,e)=>{r[o]=e,u[o]&&_(o,e)},w=(o,e)=>{s[o]=e,c[o]&&P(o,e)},A=o=>{o==="asesor"?r.permitirAsesor=!r.permitirAsesor:o==="facilitador"&&(r.permitirFacilitador=!r.permitirFacilitador),_("permisos","")},X=()=>{V(),h.value=!0},V=()=>{Object.assign(s,{textoPregunta:"",tipoPregunta:"",obligatoria:"",opciones:[]}),Object.keys(c).forEach(o=>{c[o]=""}),f.value="",k.value=""},T=()=>{if(!f.value.trim()){k.value="El texto de la opción es requerido";return}if(s.opciones.some(e=>e.textoOpcion.toLowerCase()===f.value.toLowerCase())){k.value="Esta opción ya existe";return}const o={textoOpcion:f.value.trim(),valor:s.opciones.length+1,orden:s.opciones.length+1};s.opciones.push(o),f.value="",k.value=""},Y=o=>{s.opciones.splice(o,1),s.opciones.forEach((e,b)=>{e.orden=b+1})},Z=async()=>{if(J()){if(m.value=!0,s.orden!=0){const o=r.preguntas.findIndex(e=>e.orden==s.orden);if(o!==-1)r.preguntas.splice(o,1);else{q("No se pudo editar la pregunta correctmanet");return}}try{const o={textoPregunta:s.textoPregunta,tipoPregunta:s.tipoPregunta,obligatoria:s.obligatoria,orden:r.preguntas.length+1,opciones:[...s.opciones]};r.preguntas.push(o),E.value=r.preguntas,h.value=!1,await B("Pregunta agregada correctamente")}catch(o){console.error("Error:",o),q("Error al agregar la pregunta")}finally{m.value=!1}}},ee=()=>{h.value=!1,V()},te=async()=>{if(!W()){D("Por favor, corrija los errores en el formulario");return}g.value=!0;try{console.log("Datos a enviar:",r);const o=await I(r),{data:e,status:b}=o;b!=200&&q("Oops","Ocurrio un error al crear la encuesta",2),await B("Encuesta creada","La encuesta se ha guardado correctamente",3),$.push("/surveys")}catch(o){console.error("Error:",o),q("Error al guardar la encuesta")}finally{g.value=!1}},oe=()=>{$.push("/surveys")},ae=o=>{V(),h.value=!0,s.orden=o.orden,s.obligatoria=o.obligatoria,s.tipoPregunta=o.tipoPregunta,s.opciones=o.opciones,s.textoPregunta=o.textoPregunta},se=async o=>{const e=r.preguntas[o];(await D("¿Está seguro de eliminar esta pregunta?",`"${e.textoPregunta}" será eliminada permanentemente`)).isConfirmed&&re(o)},re=o=>{r.preguntas.splice(o,1),r.preguntas.forEach((e,b)=>{e.orden=b+1}),E.value=r.preguntas,B("Pregunta eliminada correctamente")},ie=de(()=>s.tipoPregunta==="opcion_multiple"||s.tipoPregunta==="seleccion_multiple");return(o,e)=>{const b=fe("EasyDataTable");return i(),d("div",null,[n(_e,{title:"Crear Nueva Encuesta",subtitle:"Complete la información básica de la encuesta",loading:U.value,icon:"assignment_add"},{body:l(()=>[t("div",ke,[n(S,{modelValue:r.titulo,"onUpdate:modelValue":e[0]||(e[0]=a=>r.titulo=a),type:"text",label:"Título de la Encuesta",icon:"title",onBlur:e[1]||(e[1]=a=>_("titulo",r.titulo)),onInput:e[2]||(e[2]=a=>M("titulo",a.target.value)),placeholder:"Ej: Encuesta de Satisfacción del Cliente",required:!0,error:u.titulo,disabled:g.value},null,8,["modelValue","error","disabled"]),t("div",Ce,[e[19]||(e[19]=t("label",{class:"input-label"},[t("span",{class:"material-icons label-icon"},"description"),p(" Descripción de la Encuesta "),t("span",{class:"required-mark"},"*")],-1)),t("div",{class:ce(["textarea-wrapper",{"has-error":u.descripcion}])},[pe(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.descripcion=a),onBlur:e[4]||(e[4]=a=>_("descripcion",r.descripcion)),onInput:e[5]||(e[5]=a=>M("descripcion",a.target.value)),placeholder:"Describa el propósito y contexto de esta encuesta...",class:"modern-textarea",rows:"4",disabled:g.value},null,40,Ee),[[me,r.descripcion]])],2),u.descripcion?(i(),d("span",we,[e[18]||(e[18]=t("span",{class:"material-icons"},"error",-1)),p(" "+C(u.descripcion),1)])):x("",!0)]),t("div",Ae,[e[23]||(e[23]=t("label",{class:"input-label"},[t("span",{class:"material-icons label-icon"},"group"),p(" ¿Quién puede responder esta encuesta? "),t("span",{class:"required-mark"},"*")],-1)),t("div",Fe,[t("div",{class:"permission-item",onClick:e[7]||(e[7]=a=>A("asesor"))},[t("div",Oe,[t("input",{type:"checkbox",checked:r.permitirAsesor,onChange:e[6]||(e[6]=a=>A("asesor")),class:"permission-checkbox",disabled:g.value},null,40,qe),t("div",Ve,[r.permitirAsesor?(i(),d("span",Be,"check")):x("",!0)])]),e[20]||(e[20]=t("div",{class:"permission-content"},[t("div",{class:"permission-icon"},[t("span",{class:"material-icons"},"support_agent")]),t("div",{class:"permission-text"},[t("h4",null,"Asesores"),t("p",null,"Personal de atención al cliente y ventas")])],-1))]),t("div",{class:"permission-item",onClick:e[9]||(e[9]=a=>A("facilitador"))},[t("div",De,[t("input",{type:"checkbox",checked:r.permitirFacilitador,onChange:e[8]||(e[8]=a=>A("facilitador")),class:"permission-checkbox",disabled:g.value},null,40,Qe),t("div",Se,[r.permitirFacilitador?(i(),d("span",$e,"check")):x("",!0)])]),e[21]||(e[21]=t("div",{class:"permission-content"},[t("div",{class:"permission-icon"},[t("span",{class:"material-icons"},"school")]),t("div",{class:"permission-text"},[t("h4",null,"Facilitadores"),t("p",null,"Personal de capacitación y entrenamiento")])],-1))])]),u.permisos?(i(),d("span",Me,[e[22]||(e[22]=t("span",{class:"material-icons"},"error",-1)),p(" "+C(u.permisos),1)])):x("",!0)]),t("div",Te,[t("div",Le,[e[25]||(e[25]=t("div",{class:"section-title"},[t("span",{class:"material-icons"},"quiz"),t("h3",null,"Preguntas de la Encuesta")],-1)),n(y,{color:"blue",onClick:X,tooltip:"Agregar nueva pregunta",disabled:g.value},{default:l(()=>e[24]||(e[24]=[t("span",{class:"material-icons"},"add",-1),p(" Agregar Pregunta ",-1)])),_:1,__:[24]},8,["disabled"])]),t("div",Ne,[n(b,{headers:G.value,items:E.value,"search-field":j,"search-value":z.value,"header-text-direction":"center","body-text-direction":"center","rows-per-page-message":"Registros por página","empty-message":"Sin registros disponibles","rows-of-page-separator-message":"de",alternating:"","table-height":450,"buttons-pagination":"","table-class-name":"modern-table","theme-color":"#667eea",class:"custom-data-table"},{"item-obligatoria":l(a=>[a.obligatoria==!0?(i(),d("span",Ie," check_circle ")):(i(),d("span",Ue," cancel "))]),"item-actions":l(a=>[n(Q,{color:"purple",onFunction:F=>ae(a),tooltip:"Editar pregunta"},{default:l(()=>e[26]||(e[26]=[t("span",{class:"material-icons"},"edit",-1)])),_:2,__:[26]},1032,["onFunction"]),n(Q,{class:"ms-2",color:"red",onFunction:F=>se(E.value.indexOf(a)),tooltip:"Eliminar"},{default:l(()=>e[27]||(e[27]=[t("span",{class:"material-icons"},"delete",-1)])),_:2,__:[27]},1032,["onFunction"])]),_:1},8,["headers","items","search-value"])])]),e[28]||(e[28]=t("div",{class:"form-info mt-4"},[t("div",{class:"info-item"},[t("span",{class:"material-icons"},"info"),t("span",null,"Los campos marcados con * son obligatorios")]),t("div",{class:"info-item"},[t("span",{class:"material-icons"},"help_outline"),t("span",null,"Agregue al menos una pregunta para completar la encuesta")])],-1))])]),footer:l(()=>[t("div",Ge,[t("div",je,[e[29]||(e[29]=t("span",{class:"material-icons"},"info",-1)),t("span",null,C(r.preguntas.length)+" pregunta(s) agregada(s)",1)]),t("div",ze,[t("div",Re,[n(y,{color:"lile",onClick:oe,tooltip:"Cancelar y volver",disabled:g.value},{default:l(()=>e[30]||(e[30]=[t("span",{class:"material-icons"},"arrow_back",-1),p(" Cancelar ",-1)])),_:1,__:[30]},8,["disabled"]),n(y,{color:"green",onClick:te,disabled:g.value||r.preguntas.length===0,tooltip:"Guardar encuesta completa"},{default:l(()=>[g.value?(i(),L(N,{key:0})):(i(),d("span",Ke,"save")),e[31]||(e[31]=p(" Guardar Encuesta ",-1))]),_:1,__:[31]},8,["disabled"])])])])]),_:1},8,["loading"]),n(xe,{show:h.value,"onUpdate:show":e[17]||(e[17]=a=>h.value=a),title:"Agregar Nueva Pregunta",icon:"quiz",width:60,"max-width":"900px",closable:!m.value},{body:l(()=>[t("div",He,[n(S,{modelValue:s.textoPregunta,"onUpdate:modelValue":e[10]||(e[10]=a=>s.textoPregunta=a),type:"text",label:"Texto de la Pregunta",icon:"help_outline",onBlur:e[11]||(e[11]=a=>P("textoPregunta",s.textoPregunta)),onInput:e[12]||(e[12]=a=>w("textoPregunta",a.target.value)),placeholder:"Escriba aquí el texto de la pregunta...",required:!0,error:c.textoPregunta,disabled:m.value},null,8,["modelValue","error","disabled"]),t("div",We,[e[33]||(e[33]=t("label",{class:"input-label"},[t("span",{class:"material-icons label-icon"},"priority_high"),p(" ¿Es obligatoria esta pregunta? "),t("span",{class:"required-mark"},"*")],-1)),t("div",Je,[(i(),d(ge,null,ve(K,a=>t("div",{key:a.value,class:"radio-option",onClick:F=>w("obligatoria",a.value)},[t("div",Ye,[t("input",{type:"radio",checked:s.obligatoria===a.value,value:a.value,class:"radio-input",disabled:m.value,onChange:F=>w("obligatoria",a.value)},null,40,Ze),t("div",et,[s.obligatoria===a.value?(i(),d("div",tt)):x("",!0)])]),t("span",ot,C(a.label),1)],8,Xe)),64))]),c.obligatoria?(i(),d("span",at,[e[32]||(e[32]=t("span",{class:"material-icons"},"error",-1)),p(" "+C(c.obligatoria),1)])):x("",!0)]),n(he,{modelValue:s.tipoPregunta,"onUpdate:modelValue":e[13]||(e[13]=a=>s.tipoPregunta=a),label:"Tipo de Pregunta",icon:"category",options:R,"option-label":"label","option-value":"value",placeholder:"Seleccione el tipo de pregunta",onBlur:e[14]||(e[14]=a=>P("tipoPregunta",s.tipoPregunta)),onChange:e[15]||(e[15]=a=>w("tipoPregunta",a.target.value)),error:c.tipoPregunta,disabled:m.value,required:!0},null,8,["modelValue","error","disabled"]),ie.value?(i(),d("div",st,[e[37]||(e[37]=t("div",{class:"section-header-small"},[t("h4",{class:"section-title-small"},[t("span",{class:"material-icons"},"list"),p(" Opciones de Respuesta ")])],-1)),t("div",rt,[t("div",it,[t("div",nt,[n(S,{modelValue:f.value,"onUpdate:modelValue":e[16]||(e[16]=a=>f.value=a),type:"text",label:"Texto de la Opción",icon:"add_circle_outline",placeholder:"Escriba el texto de la opción...",error:k.value,disabled:m.value,onKeyup:be(T,["enter"])},null,8,["modelValue","error","disabled"])]),t("div",lt,[n(y,{color:"blue",onClick:T,disabled:m.value||!f.value.trim(),tooltip:"Agregar opción"},{default:l(()=>e[34]||(e[34]=[t("span",{class:"material-icons"},"add",-1),p(" Agregar ",-1)])),_:1,__:[34]},8,["disabled"])])])]),s.opciones.length>0?(i(),d("div",ut,[n(b,{headers:H.value,items:s.opciones,"header-text-direction":"center","body-text-direction":"center","hide-footer":"","table-height":200,"table-class-name":"modern-table","theme-color":"#667eea",class:"custom-data-table"},{"item-actions":l(a=>[n(Q,{color:"red",onFunction:F=>Y(s.opciones.indexOf(a)),tooltip:"Eliminar opción",disabled:m.value},{default:l(()=>e[35]||(e[35]=[t("span",{class:"material-icons"},"delete",-1)])),_:2,__:[35]},1032,["onFunction","disabled"])]),_:1},8,["headers","items"])])):(i(),d("div",dt,e[36]||(e[36]=[t("span",{class:"material-icons"},"info",-1),t("span",null,"No se han agregado opciones aún. Agregue al menos una opción para este tipo de pregunta.",-1)])))])):x("",!0)])]),footer:l(()=>[t("div",ct,[n(y,{color:"lile",onClick:ee,disabled:m.value,tooltip:"Cancelar"},{default:l(()=>e[38]||(e[38]=[t("span",{class:"material-icons"},"close",-1),p(" Cancelar ",-1)])),_:1,__:[38]},8,["disabled"]),n(y,{color:"green",onClick:Z,disabled:m.value,tooltip:"Guardar pregunta"},{default:l(()=>[m.value?(i(),L(N,{key:0})):(i(),d("span",pt,"save")),e[39]||(e[39]=p(" Guardar Pregunta ",-1))]),_:1,__:[39]},8,["disabled"])])]),_:1},8,["show","closable"])])}}},Et=ye(mt,[["__scopeId","data-v-1cbd3cf8"]]);export{Et as default};
